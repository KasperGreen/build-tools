{"version":3,"sources":["../../../src/tools/general/start.js"],"names":["start","webpackConfig","then","serverConfig","plugins","push","log","bundler","wpMiddleware","hotMiddleware","compilers","handleBundleComplete","stats","compilation","errors","length","target","bs","create","init","notify","ui","proxy","middleware","proxyOptions","xfwd","plugin","error","console","server","listen"],"mappings":";;;;;;;;;;AAAA;;;;AACA;;;;AACA;;;;AACA;;;;AACA;;;;AACA;;;;AACA;;;;AACA;;;;AACA;;AACA;;;;AACA;;;;AACA;;;;AACA;;;;;;AAEA,SAASA,KAAT,CAAgBC,aAAhB,EAA+B;AAC9B,sCAAkB;AACjB,sCACCC,IADD,CACM,MAAM,kCADZ,EAECA,IAFD,CAEM,MAAM;AAAA,uCACcD,aADd;;AAAA,SACFE,YADE;;AAGX;AACA;;AACAA,gBAAaC,OAAb,CAAqBC,IAArB,CAA0B,qCAAoB,EAACC,+BAAD,EAApB,CAA1B;;AAEA,SAAMC,UAAU,uBAAQN,aAAR,CAAhB;AACA,SAAMO,eAAe,oCAAqBD,OAArB,6BAArB;AACA,SAAME,gBAAgB,oCAAqBF,QAAQG,SAAR,CAAkB,CAAlB,CAArB,6BAAtB;;AAEA,OAAIC,uBAAuB,MAAM;AAChCA,2BAAuBC,SAAS,CAACA,MAAMA,KAAN,CAAY,CAAZ,EAAeC,WAAf,CAA2BC,MAA3B,CAAkCC,MAAnC,IAA6C,0BAA7E;;AAEA,UAAMC,SAAU,GAAD,uBAAQ,IAAR,uBAAgB,EAA/B;;AAEA,6BAAUA,MAAV,EAAkBd,IAAlB,CAAuB,MAAM;AAC5B,WAAMe,KAAK,sBAAYC,MAAZ,EAAX;;AAEAD,QAAGE,IAAH,cACI,mCAAgB,EAAhB,GAAqB,EAACC,kCAAD,EAAkBC,8BAAlB,EADzB;;AAGCC,aAAO;AACNN,aADM;AAENO,mBAAY,CAAC,4BAAD,EAAaf,YAAb,EAA2BC,aAA3B,CAFN;AAGNe,qBAAc;AACbC,cAAM;AADO;AAHR;AAHR;AAWA,KAdD;AAeA,IApBD;;AAsBAlB,WAAQmB,MAAR,CAAe,MAAf,EAAuBd,SAASD,qBAAqBC,KAArB,CAAhC;AACA,GApCD,EAoCIe,KAAD,IAAW;AACbC,WAAQD,KAAR,CAAcA,KAAd;AACA,GAtCD;AAuCA,EAxCD,MAwCO;AACN,QAAME,SAAS,+BAAQ,uBAAQ5B,aAAR,CAAR,6BAAf;;AAEA4B,SAAOC,MAAP,mDAA0B,MAAMF,QAAQtB,GAAR,CAAa,eAAD,yBAAsB,EAAlC,CAAhC;AACA;AACD;;kBAEcN,K","file":"start.js","sourcesContent":["import webpack from 'webpack'\nimport compress from 'compression'\nimport browserSync from 'browser-sync'\nimport webpackDevMiddleware from 'webpack-dev-middleware'\nimport webpackHotMiddleware from 'webpack-hot-middleware'\nimport WriteFilePlugin from 'write-file-webpack-plugin'\nimport WDS from 'webpack-dev-server'\nimport webpackDevServerConfig from '../../configs/webpack/webpack.devserver.config'\nimport { host, port, socket, isIsomorphic, isDevelopment, isDebug } from '../../configs/prepare.build-tools.config'\nimport runServer from '../../configs/utils/runServer'\nimport run from '../run'\nimport clean from './clean'\nimport copy from './copy'\n\nfunction start (webpackConfig) {\n\tif (isIsomorphic) {\n\t\trun(clean)\n\t\t.then(() => run(copy))\n\t\t.then(() => {\n\t\t\tconst [, serverConfig] = webpackConfig\n\n\t\t\t// Save the server-side bundle files to the file system after compilation\n\t\t\t// https://github.com/webpack/webpack-dev-server/issues/62\n\t\t\tserverConfig.plugins.push(new WriteFilePlugin({log: isDebug}))\n\n\t\t\tconst bundler = webpack(webpackConfig)\n\t\t\tconst wpMiddleware = webpackDevMiddleware(bundler, webpackDevServerConfig)\n\t\t\tconst hotMiddleware = webpackHotMiddleware(bundler.compilers[0], webpackDevServerConfig)\n\n\t\t\tlet handleBundleComplete = () => {\n\t\t\t\thandleBundleComplete = stats => !stats.stats[1].compilation.errors.length && runServer()\n\n\t\t\t\tconst target = `${host}:${port}`\n\n\t\t\t\trunServer(target).then(() => {\n\t\t\t\t\tconst bs = browserSync.create()\n\n\t\t\t\t\tbs.init({\n\t\t\t\t\t\t...isDevelopment ? {} : {notify: isDebug, ui: isDebug},\n\n\t\t\t\t\t\tproxy: {\n\t\t\t\t\t\t\ttarget,\n\t\t\t\t\t\t\tmiddleware: [compress(), wpMiddleware, hotMiddleware],\n\t\t\t\t\t\t\tproxyOptions: {\n\t\t\t\t\t\t\t\txfwd: true,\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t},\n\t\t\t\t\t})\n\t\t\t\t})\n\t\t\t}\n\n\t\t\tbundler.plugin('done', stats => handleBundleComplete(stats))\n\t\t}, (error) => {\n\t\t\tconsole.error(error)\n\t\t})\n\t} else {\n\t\tconst server = new WDS(webpack(webpackConfig), webpackDevServerConfig)\n\n\t\tserver.listen(port, host, () => console.log(`Launched on ${socket}`))\n\t}\n}\n\nexport default start\n"]}